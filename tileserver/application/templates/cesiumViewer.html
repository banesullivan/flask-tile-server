{% extends "base.html" %}

{% block content %}

{% include '_include/cesium.html' %}

<script>
    var extents = JSON.parse('{{ bounds|tojson }}');
    var boxjson = {
        "type": "Polygon",
        "coordinates": [
            [
                [extents.xmin, extents.ymin],
                [extents.xmin, extents.ymax],
                [extents.xmax, extents.ymax],
                [extents.xmax, extents.ymin],
                [extents.xmin, extents.ymin]
            ]
        ]
    };

    var tileUrl = `${host}/tiles/{z}/{x}/{y}.png?projection=EPSG:3857&filename=${filename}`

    var tileProvider = new Cesium.UrlTemplateImageryProvider({
        url: tileUrl,
        subdomains: null,
        // minimumLevel: 0,
        // maximumLevel: 14
    })
    var layers = viewer.scene.imageryLayers;
    var tileLayer = layers.addImageryProvider(tileProvider);

    // Compute viewing parameters
    var a = Cesium.Cartesian3.fromDegrees(extents.xmin, extents.ymin, 0)
    var b = Cesium.Cartesian3.fromDegrees(extents.xmax, extents.ymax, 0)
    var length = Math.sqrt((b.x - a.x) ** 2 + (b.y - a.y) ** 2)
    var center = Cesium.Cartesian3.fromDegrees(
        ((extents.xmax - extents.xmin) / 2 + extents.xmin),
        ((extents.ymax - extents.ymin) / 2 + extents.ymin), length)
    viewer.camera.flyTo({
        destination: center
    });
</script>

{% endblock %}
